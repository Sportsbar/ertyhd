using EmployeePortal.API.Interfaces;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using System.Net.Http;

namespace EmployeePortal.API.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class ExternalAPIController : ControllerBase
    {
       // private readonly IDapperService _ccmsemployeeService;
       // private readonly IHttpClientFactory _httpClientFactory;

        public ExternalAPIController()
        {
          //  _ccmsemployeeService = ccmsemployeeService;
           // _httpClientFactory = httpClientFactory;
        }

        [HttpGet("stockmarket")]
        public async Task<IActionResult> GetStockMarketDataAsync()
        {
            var httpClient = new HttpClient();
            httpClient.DefaultRequestHeaders.Add("X-RapidAPI-Key", "1e2ec106b3mshefc9ca2ecbadf57p139c6fjsn3cec519b4f8e");
            httpClient.DefaultRequestHeaders.Add("X-RapidAPI-Host", "alpha-vantage.p.rapidapi.com");

            var response = await httpClient.GetAsync("https://alpha-vantage.p.rapidapi.com/query?interval=5min&function=TIME_SERIES_INTRADAY&symbol=MSFT&datatype=json&output_size=compact");

            if (response.IsSuccessStatusCode)
            {
                var result = await response.Content.ReadAsStringAsync();
                return Ok(result);
            }
            else
            {
                return StatusCode((int)response.StatusCode);
            }
        }

    }
}
