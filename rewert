
ALTER PROCEDURE get_employee_by_ident
  @employee_ident int = NULL,
  @employee_first_name varchar(50) = NULL,
  @employee_middle_name varchar(50) = NULL,
  @employee_last_name varchar(50) = NULL,
  @action varchar(10)
AS
BEGIN
  IF @action = 'get'
  BEGIN
    SELECT *
    FROM ccms_employee
    WHERE employee_ident = @employee_ident
  END
  ELSE IF @action = 'insert'
  BEGIN
    DECLARE @InsertedRows table (employee_ident int)

    INSERT INTO ccms_employee (employee_ident, employee_first_name, employee_middle_name, employee_last_name)
    OUTPUT INSERTED.employee_ident INTO @InsertedRows
    VALUES (@employee_ident, @employee_first_name, @employee_middle_name, @employee_last_name)

    SELECT employee_ident FROM @InsertedRows
  END
  ELSE IF @action = 'update'
  BEGIN
    DECLARE @UpdatedRows table (employee_ident int)

    UPDATE ccms_employee
    SET employee_first_name = COALESCE(@employee_first_name, employee_first_name),
      employee_middle_name = COALESCE(@employee_middle_name, employee_middle_name),
      employee_last_name = COALESCE(@employee_last_name, employee_last_name)
    OUTPUT INSERTED.employee_ident INTO @UpdatedRows
    WHERE employee_ident = @employee_ident

    SELECT employee_ident FROM @UpdatedRows
  END
  ELSE IF @action = 'delete'
  BEGIN
    DELETE FROM ccms_employee
    WHERE employee_ident = @employee_ident
  END
END
